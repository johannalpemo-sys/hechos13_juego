<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>La exhortaci√≥n de Pablo en Antioqu√≠a ‚Äî Juego</title>
<style>
  :root{--bg:#f3f3f3;--card-radius:12px}
  body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:18px;background:var(--bg);color:#111}
  h1{font-size:20px;margin:0 0 8px;text-align:center}
  .top{max-width:980px;margin:0 auto}
  #timer{font-weight:700;color:#b71c1c;margin-top:6px;text-align:center}
  .container{display:flex;gap:18px;flex-wrap:wrap;justify-content:center;margin-top:18px}
  .dropzone{flex:0 1 320px;min-height:140px;border-radius:12px;border:2px dashed #444;padding:12px;background:#fff;box-sizing:border-box;display:flex;flex-direction:column;gap:10px;align-items:center;transition:height .25s ease}
  #judios{background:#fde0dc}
  #gentiles{background:#e0f7fa}
  .dropzone h2{margin:0;font-size:16px;align-self:flex-start}
  #imagenes{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:18px}
  .item{width:110px;height:110px;border-radius:var(--card-radius);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;text-align:center;padding:8px;box-sizing:border-box;user-select:none;touch-action:none;cursor:grab;position:relative}
  .item-wrapper{position:relative;display:inline-block}
  #versiculos{margin:20px auto 0;background:#fff;padding:12px;border-radius:10px;max-width:900px;text-align:left;display:block}
  #versiculos h3{margin:0 0 8px}
  #versiculos-items p{margin:6px 0}
  #gameOverModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:999;align-items:center;justify-content:center}
  #gameOverContent{background:#fff;padding:22px;border-radius:12px;width:90%;max-width:420px;text-align:center;animation:pop .35s ease}
  @keyframes pop{from{transform:scale(.85);opacity:0}to{transform:scale(1);opacity:1}}
  button{margin-top:12px;padding:10px 16px;border-radius:8px;border:0;background:#1976d2;color:#fff;font-weight:700;cursor:pointer}
  @media (max-width:600px){
    .dropzone{flex-basis:90%}
    .item{width:96px;height:96px}
  }
</style>
</head>
<body>
<div class="top">
  <h1>  La exhortaci√≥n de Pablo en Antioqu√≠a (3¬™. Parte)<br>
  Regocijo y persecuci√≥n por la Palabra<br>
  Hechos 13:42-52</h1>
  <div id="timer">Tiempo: 60</div>

  <div class="container">
    <div id="judios" class="dropzone" data-type="negativo">
      <h2>Jud√≠os</h2>
    </div>
    <div id="gentiles" class="dropzone" data-type="positivo">
      <h2>Gentiles</h2>
    </div>
  </div>

  <div id="imagenes">
    <div class="item-wrapper"><div class="item" data-type="positivo" style="background:#E53935">Regocijo</div></div>
    <div class="item-wrapper"><div class="item" data-type="positivo" style="background:#43A047">Glorificar la Palabra</div></div>
    <div class="item-wrapper"><div class="item" data-type="positivo" style="background:#1E88E5">Fe</div></div>
    <div class="item-wrapper"><div class="item" data-type="positivo" style="background:#FDD835;color:#111">Gozo</div></div>

    <div class="item-wrapper"><div class="item" data-type="negativo" style="background:#FB8C00">Celos</div></div>
    <div class="item-wrapper"><div class="item" data-type="negativo" style="background:#8E24AA">Contradicci√≥n</div></div>
    <div class="item-wrapper"><div class="item" data-type="negativo" style="background:#00ACC1">Blasfemia</div></div>
    <div class="item-wrapper"><div class="item" data-type="negativo" style="background:#D81B60">Persecuci√≥n</div></div>
  </div>

  <audio id="correctSound" src="correct.mp3" preload="auto"></audio>
  <audio id="wrongSound" src="wrong.mp3" preload="auto"></audio>

  <div id="versiculos">
    <h3>Vers√≠culos (se muestran conforme coloques):</h3>
    <div id="versiculos-items"></div>
  </div>

  <div id="gameOverModal">
    <div id="gameOverContent">
      <div id="gameOverText"></div>
      <button id="restartBtn">Jugar de nuevo</button>
    </div>
  </div>
</div>

<script>
const versiculos = {
  "Regocijo":"Hechos 13:48 ‚Äî Los gentiles, oyendo esto, se regocijaban y glorificaban la palabra del Se√±or.",
  "Glorificar la Palabra":"Hechos 13:48 ‚Äî Los gentiles glorificaron la palabra del Se√±or.",
  "Fe":"Hechos 13:48 ‚Äî Creyeron los que estaban ordenados para vida eterna.",
  "Gozo":"Hechos 13:52 ‚Äî Los disc√≠pulos estaban llenos de gozo y del Esp√≠ritu Santo.",
  "Celos":"Hechos 13:45 ‚Äî Los jud√≠os se llenaron de celos.",
  "Contradicci√≥n":"Hechos 13:45 ‚Äî Rebat√≠an y contradec√≠an a Pablo.",
  "Blasfemia":"Hechos 13:45 ‚Äî Algunos llegaban a blasfemar.",
  "Persecuci√≥n":"Hechos 13:50 ‚Äî Levantaron persecuci√≥n contra Pablo y Bernab√©."
};

let items = Array.from(document.querySelectorAll(".item"));
let dropzones = Array.from(document.querySelectorAll(".dropzone"));
const imgsContainer = document.getElementById("imagenes");
const versosContainer = document.getElementById("versiculos-items");
const timerEl = document.getElementById("timer");
const modal = document.getElementById("gameOverModal");
const gameOverText = document.getElementById("gameOverText");
const restartBtn = document.getElementById("restartBtn");

let timer = 60;
let countdown = setInterval(tick,1000);
let correctCount = 0;
let errorCount = 0;
let gameOver = false;

function tick(){
  if(gameOver) return;
  timer--;
  timerEl.textContent = "Tiempo: " + timer;
  if(timer<=0){ clearInterval(countdown); finishGame(true); }
}

let current = null;
let offsetX = 0, offsetY = 0;
let originalParent = null;

// ======= Drag & Drop mejorado para scroll y touch =======
function onStart(e){
  if(gameOver) return;
  const isTouch = e.type==="touchstart";
  const ev = isTouch ? e.touches[0] : e;
  const wrapper = this.parentElement;
  const item = this;
  if(item.dataset.locked==="true") return;

  current = wrapper;
  originalParent = wrapper.parentElement;

  const rect = wrapper.getBoundingClientRect();
  offsetX = ev.pageX - (rect.left + window.scrollX);
  offsetY = ev.pageY - (rect.top + window.scrollY);

  document.body.appendChild(wrapper);
  wrapper.style.position = "absolute";
  wrapper.style.left = rect.left + window.scrollX + "px";
  wrapper.style.top  = rect.top + window.scrollY + "px";
  wrapper.style.zIndex = 9999;

  if(isTouch) e.preventDefault();
}

function onMove(e){
  if(!current) return;
  const isTouch = e.type==="touchmove";
  const ev = isTouch ? e.touches[0] : e;
  if(isTouch) e.preventDefault();

  current.style.left = (ev.pageX - offsetX) + "px";
  current.style.top  = (ev.pageY - offsetY) + "px";
}

function onEnd(e){
  if(!current) return;
  const wrapper = current;
  const item = wrapper.querySelector(".item");
  const rect = wrapper.getBoundingClientRect();
  const centerX = rect.left + rect.width/2;
  const centerY = rect.top + rect.height/2;

  let placedZone = null;
  for(const zone of dropzones){
    const zr = zone.getBoundingClientRect();
    if(centerX>=zr.left && centerX<=zr.right && centerY>=zr.top && centerY<=zr.bottom){
      placedZone = zone;
      break;
    }
  }

  if(placedZone){
    placedZone.appendChild(wrapper);
    wrapper.style.position = "static";
    wrapper.style.left = "";
    wrapper.style.top = "";
    wrapper.style.zIndex = "";
    markResult(item, placedZone);
    checkAllPlaced();
  } else {
    imgsContainer.appendChild(wrapper);
    wrapper.style.position = "static";
    wrapper.style.left = "";
    wrapper.style.top = "";
    wrapper.style.zIndex = "";
  }
  current = null;
}

items.forEach(it=>{
  it.addEventListener("mousedown",onStart);
  it.addEventListener("touchstart",onStart,{passive:false});
});
document.addEventListener("mousemove",onMove);
document.addEventListener("touchmove",onMove,{passive:false});
document.addEventListener("mouseup",onEnd);
document.addEventListener("touchend",onEnd);

// ====== Evaluaci√≥n y resultados ======
function markResult(item, zone, forceWrong=false){
  if(item.dataset.locked==="true") return;
  const key = item.innerText.trim();
  const correct = !forceWrong && (item.dataset.type===zone.dataset.type);

  item.dataset.locked="true";
  item.style.cursor="default";

  const p = document.createElement("p");
  p.innerHTML=`<strong>${key}:</strong> ${versiculos[key] || ""}`;
  versosContainer.appendChild(p);

  try{
    if(correct) document.getElementById("correctSound").play();
    else document.getElementById("wrongSound").play();
  }catch(err){}

  if(correct) correctCount++; else errorCount++;
}

function checkAllPlaced(){
  if(items.every(it=>it.dataset.locked==="true")){
    finishGame(false);
  }
}

function finishGame(timeout=false){
  if(gameOver) return;
  gameOver = true;
  clearInterval(countdown);

  items.forEach(it=>{
    if(it.dataset.locked!=="true"){
      const wrapper = it.parentElement;
      const targetZone = it.dataset.type==="positivo"?document.getElementById("gentiles"):document.getElementById("judios");
      targetZone.appendChild(wrapper);
      wrapper.style.position="static";
      wrapper.style.left="";
      wrapper.style.top="";
      markResult(it, targetZone, timeout);
    }
  });

  let msg = "üéâ ¬°Juego completado! üéâ";
  if(errorCount>0) msg += `\nTuvo ${errorCount} error(es). ¬°Repasa el pasaje y vuelve a intentarlo!`;
  if(timeout && correctCount===0) msg = "‚è∞ ¬°Tiempo agotado! Todos los elementos fueron incorrectos.";

  gameOverText.innerText = msg;
  modal.style.display="flex";
}

restartBtn.addEventListener("click",()=>{
  correctCount=0; errorCount=0; gameOver=false;
  versosContainer.innerHTML="";
  modal.style.display="none";
  timer=60; timerEl.textContent="Tiempo: "+timer;
  clearInterval(countdown); countdown=setInterval(tick,1000);

  const wrappers = Array.from(document.querySelectorAll(".item-wrapper"));
  wrappers.forEach(w=>{
    imgsContainer.appendChild(w);
    w.style.position="relative";
    w.style.left=""; w.style.top=""; w.style.zIndex="";
    const it = w.querySelector(".item");
    it.dataset.locked="";
    it.style.cursor="grab";
  });
});
</script>
</body>
</html>
