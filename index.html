<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>La exhortaciÃ³n de Pablo en AntioquÃ­a (3Âª Parte) - Hechos 13:42-52</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f3f3f3;
        padding: 20px;
        text-align: center;
    }

    h1 { font-size: 22px; margin-bottom: 10px; }
    #timer { font-size: 22px; font-weight: bold; color: #d32f2f; }

    /* Contenedor principal */
    .container {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        margin-top: 20px;
        gap: 20px;
    }

    /* Dropzones que CRECEN automÃ¡ticamente */
    .dropzone {
        width: 40%;
        min-height: 180px;
        background: white;
        border: 3px dashed #555;
        border-radius: 10px;
        padding: 15px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 10px;
        transition: all 0.3s ease;
    }

    #judios { background: #fde0dc; }
    #gentiles { background: #e0f7fa; }

    /* Tarjetas "item" */
    .item {
        width: 120px;
        height: 120px;
        border-radius: 12px;
        color: white;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        text-align: center;
        font-size: 15px;
        cursor: grab;
        user-select: none;
        position: relative;
    }

    /* Opciones */
    #imagenes {
        margin-top: 25px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
    }

    /* Marcador âœ” âœ˜ */
    .marker {
        position: absolute;
        top: -10px;
        right: -10px;
        font-size: 28px;
        font-weight: bold;
    }

    /* VersÃ­culos */
    #versiculos {
        margin-top: 30px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
    }

    /* Modal final */
    #gameOverModal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        justify-content: center;
        align-items: center;
        z-index: 999;
    }

    #gameOverContent {
        background: white;
        padding: 30px;
        border-radius: 15px;
        width: 80%;
        max-width: 450px;
        animation: popIn .4s;
    }

    @keyframes popIn {
        from { transform: scale(.6); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }
</style>
</head>

<body>

<h1>La exhortaciÃ³n de Pablo en AntioquÃ­a (3Âª Parte)<br>Regocijo y persecuciÃ³n por la Palabra<br>Hechos 13:42-52</h1>

<div id="timer">Tiempo: 60</div>

<h3>Arrastra cada reacciÃ³n al grupo correcto</h3>

<div class="container">
    <div id="judios" class="dropzone" data-type="negativo">
        <h2>JudÃ­os</h2>
    </div>

    <div id="gentiles" class="dropzone" data-type="positivo">
        <h2>Gentiles</h2>
    </div>
</div>

<!-- Tarjetas -->
<div id="imagenes">
    <div class="item" draggable="true" data-type="positivo" style="background:#4CAF50;">Regocijo</div>
    <div class="item" draggable="true" data-type="positivo" style="background:#1E88E5;">Glorificar la Palabra</div>
    <div class="item" draggable="true" data-type="positivo" style="background:#FDD835;">Fe</div>
    <div class="item" draggable="true" data-type="positivo" style="background:#FB8C00;">Gozo</div>

    <div class="item" draggable="true" data-type="negativo" style="background:#f44336;">Celos</div>
    <div class="item" draggable="true" data-type="negativo" style="background:#8E24AA;">ContradicciÃ³n</div>
    <div class="item" draggable="true" data-type="negativo" style="background:#00ACC1;">Blasfemia</div>
    <div class="item" draggable="true" data-type="negativo" style="background:#D81B60;">PersecuciÃ³n</div>
</div>

<!-- Audios -->
<audio id="correctSound" src="correct.mp3"></audio>
<audio id="wrongSound" src="wrong.mp3"></audio>

<div id="versiculos">
    <h2>VersÃ­culos:</h2>
    <div id="versiculos-items"></div>
</div>

<!-- Modal fin -->
<div id="gameOverModal">
    <div id="gameOverContent">
        <div id="gameOverText"></div>
        <button onclick="location.reload()">Jugar de nuevo</button>
    </div>
</div>

<script>
// =========================
// VARIABLES DEL JUEGO
// =========================
let items = document.querySelectorAll(".item");
let dropzones = document.querySelectorAll(".dropzone");
let totalItems = items.length;
let correctCount = 0;
let errorCount = 0;
let gameOver = false;

// VersÃ­culos
const versiculos = {
    "Regocijo": "Hechos 13:48",
    "Glorificar la Palabra": "Hechos 13:48",
    "Fe": "Hechos 13:48",
    "Gozo": "Hechos 13:52",
    "Celos": "Hechos 13:45",
    "ContradicciÃ³n": "Hechos 13:45",
    "Blasfemia": "Hechos 13:45",
    "PersecuciÃ³n": "Hechos 13:52"
};

// =========================
// TIMER
// =========================
let timer = 60;
let timerEl = document.getElementById("timer");
let countdown = setInterval(() => {
    if (gameOver) return;
    timer--;
    timerEl.textContent = "Tiempo: " + timer;

    if (timer <= 0) {
        clearInterval(countdown);
        finishGame();
    }
}, 1000);


// =========================
// DRAG & DROP PARA MOUSE
// =========================
items.forEach(item => {
    item.addEventListener("dragstart", e => {
        if (item.dataset.locked === "true" || gameOver) e.preventDefault();
        e.dataTransfer.setData("id", item.innerText);
    });
});

dropzones.forEach(zone => {
    zone.addEventListener("dragover", e => e.preventDefault());
    zone.addEventListener("drop", e => {
        e.preventDefault();
        const id = e.dataTransfer.getData("id");
        let item = [...items].find(x => x.innerText === id);
        handleDrop(item, zone);
    });
});


// =========================
// TOUCH EVENTS PARA CELULAR
// =========================
items.forEach(item => {
    item.addEventListener("touchstart", e => {
        if (item.dataset.locked === "true" || gameOver) return;

        let touch = e.touches[0];
        let offsetX = touch.clientX - item.getBoundingClientRect().left;
        let offsetY = touch.clientY - item.getBoundingClientRect().top;

        item.style.position = "absolute";
        item.style.zIndex = 999;

        function moveAt(touchEvent) {
            let t = touchEvent.touches[0];
            item.style.left = t.clientX - offsetX + "px";
            item.style.top = t.clientY - offsetY + "px";
        }

        function onMove(e2) { moveAt(e2); }

        document.addEventListener("touchmove", onMove);

        item.addEventListener("touchend", e3 => {
            document.removeEventListener("touchmove", onMove);

            let droppedZone = [...dropzones].find(z => {
                let rect = z.getBoundingClientRect();
                return (
                    touch.clientX > rect.left &&
                    touch.clientX < rect.right &&
                    touch.clientY > rect.top &&
                    touch.clientY < rect.bottom
                );
            });

            if (droppedZone) handleDrop(item, droppedZone);
            else {
                // Regresar al origen
                item.style.position = "static";
            }

        }, { once: true });
    });
});


// =========================
// FUNCIÃ“N CENTRAL: HANDLE DROP
// =========================
function handleDrop(item, zone) {
    if (!item || !zone || item.dataset.locked === "true" || gameOver) return;

    let mark = document.createElement("div");
    mark.className = "marker";

    if (item.dataset.type === zone.dataset.type) {
        mark.textContent = "âœ”";
        mark.style.color = "green";
        correctCount++;
        document.getElementById("correctSound").play();
    } else {
        mark.textContent = "âœ˜";
        mark.style.color = "red";
        errorCount++;
        document.getElementById("wrongSound").play();
    }

    item.appendChild(mark);

    // Bloquear
    item.dataset.locked = "true";
    item.style.position = "static";
    item.style.cursor = "default";

    // insertar dentro del dropzone
    zone.appendChild(item);

    // VersÃ­culo
    let p = document.createElement("p");
    p.innerHTML = `<b>${item.innerText}:</b> ${versiculos[item.innerText]}`;
    document.getElementById("versiculos-items").appendChild(p);

    if (correctCount + errorCount === totalItems) endGame();
}


// =========================
// FIN DEL JUEGO
// =========================
function finishGame() {
    gameOver = true;
    clearInterval(countdown);

    // Mover automÃ¡ticamente faltantes
    items.forEach(item => {
        if (!item.dataset.locked) {
            let zone = item.dataset.type === "positivo"
                ? document.getElementById("gentiles")
                : document.getElementById("judios");
            handleDrop(item, zone);
        }
    });

    endGame();
}

function endGame() {
    gameOver = true;
    clearInterval(countdown);

    let msg = "ðŸŽ‰ Â¡Juego completado! ðŸŽ‰<br>";
    if (errorCount > 0) {
        msg += "Hubo algunos errores, Â¡pero puedes seguir repasando el pasaje! ðŸ™Œ";
    }

    document.getElementById("gameOverText").innerHTML = msg;
    document.getElementById("gameOverModal").style.display = "flex";
}

</script>
</body>
</html>
